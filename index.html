<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com;
    style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;
    font-src 'self' https://cdnjs.cloudflare.com;
    img-src 'self' data: blob: https://yspjsauqjqujdavwagnw.supabase.co;
    connect-src 'self' https://yspjsauqjqujdavwagnw.supabase.co wss://yspjsauqjqujdavwagnw.supabase.co https://cdn.tailwindcss.com;
    worker-src 'self' blob:;
    frame-src 'self' blob:;
    object-src 'none';
    base-uri 'self';
  ">
  <title>SIRÇA AKADEMİ(KOMİSERİM PAEMİSYON)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-slate-50 text-slate-900">
  <div id="root">
    <!-- Initial Loader -->
    <div id="initial-loader"
      style="position:fixed;top:0;left:0;width:100%;height:100%;background:#f8fafc;display:flex;justify-content:center;align-items:center;z-index:9999;transition:opacity 0.5s;">
      <div style="text-align:center;font-family:sans-serif;color:#475569;">
        <div style="font-size:30px;margin-bottom:10px;">
          <i class="fas fa-circle-notch fa-spin" style="color:#2563eb;"></i>
        </div>
        <div>Yükleniyor...</div>
        <div style="font-size:12px;margin-top:10px;color:#94a3b8">v1.2.0 - Redmi Patch</div>
      </div>
    </div>

  </div>
  </div>

  <!-- Global Shim for Older Devices -->
  <script>
    if (typeof global === 'undefined') {
      window.global = window;
    }
  </script>

  <!-- Crash Handler Script -->
  <script>
    (function () {
      // Safe error UI builder to prevent XSS
      function showSafeError(title, message, buttonText, code) {
        var loader = document.getElementById('initial-loader');
        if (!loader) return;

        // Clear existing content safely
        loader.textContent = '';

        // Style the container
        loader.style.flexDirection = 'column';

        var container = document.createElement('div');
        container.style.color = '#ef4444';
        container.style.padding = '20px';
        container.style.maxWidth = '300px';
        container.style.margin = '0 auto';
        container.style.textAlign = 'center';
        container.style.fontFamily = 'sans-serif';

        var h3 = document.createElement('h3');
        h3.textContent = title;
        h3.style.fontSize = '18px';
        h3.style.fontWeight = 'bold';
        h3.style.marginBottom = '8px';

        var p = document.createElement('p');
        p.textContent = message; // SAFETY: textContent escapes HTML
        p.style.fontSize = '14px';
        p.style.marginBottom = '16px';

        var btn = document.createElement('button');
        btn.textContent = buttonText;
        btn.onclick = function () { window.location.reload(true); };
        btn.style.background = '#2563eb';
        btn.style.color = '#fff';
        btn.style.border = 'none';
        btn.style.padding = '12px 24px';
        btn.style.borderRadius = '8px';
        btn.style.fontWeight = 'bold';
        btn.style.cursor = 'pointer';

        container.appendChild(h3);
        container.appendChild(p);
        container.appendChild(btn);

        if (code) {
          var codeP = document.createElement('p');
          codeP.textContent = code;
          codeP.style.fontSize = '11px';
          codeP.style.marginTop = '20px';
          codeP.style.color = '#94a3b8';
          container.appendChild(codeP);
        }

        loader.appendChild(container);
      }

      window.addEventListener('load', function () {
        var loader = document.getElementById('initial-loader');

        // Timeout to detect crash (Extended to 20s for mobile data)
        setTimeout(function () {
          // If loader is still there...
          if (loader && document.body.contains(loader)) {
            // Check if root has other children (meaning React mounted but loader didn't vanish)
            var rootHandler = document.getElementById('root');
            if (rootHandler && rootHandler.children.length === 0) { // React hasn't mounted anything yet
              showSafeError(
                'Yükleme Sorunu',
                'Sayfa yanıt vermiyor. Bağlantınız yavaş olabilir veya cihazınız bu sürümü desteklemiyor.',
                'Sayfayı Yenile',
                'Hata Kodu: CONNECTION_TIMEOUT_20S'
              );
            }
          }
        }, 20000);
      });

      window.onerror = function (msg, url, lineNo, columnNo, error) {
        var loader = document.getElementById('initial-loader');
        if (loader) {
          showSafeError(
            'Uygulama Hatası',
            'Bir hata oluştu: ' + msg,
            'Yeniden Dene'
          );
          return true;
        }
        return false;
      };
    })();
  </script>
  <script type="module" src="/index.tsx"></script>
</body>

</html>